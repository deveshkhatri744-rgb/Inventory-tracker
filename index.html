<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üì¶ Inventory QR Scanner</title>
<script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f5f5f5;
    text-align: center;
    padding: 20px;
  }
  h2 { color: #222; }
  #reader {
    width: 300px;
    margin: 20px auto;
    border: 2px solid #007bff;
    border-radius: 10px;
    background: white;
  }
  button {
    padding: 10px 16px;
    font-size: 16px;
    border: none;
    border-radius: 6px;
    margin: 6px;
    color: white;
    background-color: #007bff;
  }
  button:disabled { background-color: #999; }
</style>
</head>
<body>
  <h2>üì¶ Inventory QR Code Scanner</h2>
  <div id="reader"></div>
  <p id="status">Click "Start Scanning" to begin.</p>
  <button id="startButton">Start Scanning</button>
  <button id="stopButton" disabled>Stop</button>

<script>
const html5QrCode = new Html5Qrcode("reader");
const startButton = document.getElementById("startButton");
const stopButton = document.getElementById("stopButton");
const status = document.getElementById("status");

// Replace this with your correct Apps Script Web App URL
const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxZs18oHhoglSsUDYbX8Z0PXGGmgCu85ZC2x46nGGEiBHF84vWU2aKnjuO6US_mSXqzag/exec";

let isScanning = false;

async function startScanner() {
  try {
    const devices = await Html5Qrcode.getCameras();
    if (!devices || devices.length === 0) {
      status.textContent = "‚ùå No camera found.";
      return;
    }

    // Prefer the back camera if available
    const backCamera = devices.find(d => /back|rear|environment/i.test(d.label)) || devices[0];

    await html5QrCode.start(
      { deviceId: { exact: backCamera.id } },
      { fps: 10, qrbox: { width: 230, height: 230 } },
      (decodedText, decodedResult) => {
        status.textContent = "‚úÖ Scanned: " + decodedText;
        sendToSheet(decodedText);
        stopScanner();
      },
      (errorMessage) => { /* ignore scan errors */ }
    );

    status.textContent = "üì∑ Scanning for QR code...";
    isScanning = true;
    startButton.disabled = true;
    stopButton.disabled = false;

  } catch (err) {
    console.error("Camera error:", err);
    status.textContent = "‚ö†Ô∏è Camera access denied or unavailable.";
  }
}

async function stopScanner() {
  if (isScanning) {
    await html5QrCode.stop();
    isScanning = false;
    status.textContent = "Scanner stopped.";
    startButton.disabled = false;
    stopButton.disabled = true;
  }
}

function sendToSheet(qrData) {
  fetch(GOOGLE_SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({ qrData }),
    headers: { "Content-Type": "application/json" }
  })
  .then(res => res.text())
  .then(data => {
    console.log("Google Sheet response:", data);
    status.textContent = "‚úÖ Data sent successfully!";
  })
  .catch(err => {
    console.error("Send error:", err);
    status.textContent = "‚ùå Failed to send data to sheet.";
  });
}

startButton.addEventListener("click", startScanner);
stopButton.addEventListener("click", stopScanner);
</script>
</body>
</html>
