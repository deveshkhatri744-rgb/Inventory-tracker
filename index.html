<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QR Sale Scanner (Auto Daily Log)</title>
<script src="https://unpkg.com/html5-qrcode"></script>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f7f9fb;
    margin: 0;
    text-align: center;
    padding: 20px;
  }
  h2 { color: #222; }
  #reader {
    width: 320px;
    height: 240px;
    margin: 0 auto;
    border: 2px solid #0078d7;
    border-radius: 8px;
    background: white;
  }
  button {
    padding: 10px 20px;
    margin-top: 10px;
    border: none;
    background: #0078d7;
    color: white;
    border-radius: 6px;
    cursor: pointer;
  }
  button:hover { background: #005fa3; }
  #status {
    margin-top: 15px;
    font-size: 14px;
    color: green;
  }
</style>
</head>
<body>

<h2>ðŸ“¦ Scan Product QR to Record Daily Sale</h2>
<div id="reader"></div>
<p id="status">Waiting for scan...</p>
<button onclick="startScanner()">Start Scanner</button>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxoC-VNL3sl-v3lfiFkmBK70FN70qR-OSgM_Z4PbIm5jC2GCsuWHhQ_kqoz9YXVdDiBIg/exec"; // Paste Apps Script URL

function startScanner() {
  const html5QrCode = new Html5Qrcode("reader");

  Html5Qrcode.getCameras().then(cameras => {
    if (cameras && cameras.length) {
      html5QrCode.start(
        cameras[0].id,
        { fps: 10, qrbox: { width: 250, height: 250 } },
        qrCodeMessage => {
          document.getElementById("status").innerText = "âœ… QR Scanned Successfully!";
          console.log("QR Data:", qrCodeMessage);

          // Prepare and send data to Google Sheet
          const data = {
            productName: "QR Product",
            imageURL: qrCodeMessage,
            qrData: qrCodeMessage
          };

          fetch(SCRIPT_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
          })
          .then(res => res.json())
          .then(res => {
            if (res.status === "success") {
              document.getElementById("status").innerText =
                "âœ… Sale logged in " + res.sheet;
            } else {
              document.getElementById("status").innerText =
                "âŒ Error: " + res.message;
            }
            html5QrCode.stop(); // Stop after one scan
          })
          .catch(err => {
            document.getElementById("status").innerText = "âŒ Network error: " + err;
            console.error(err);
          });
        }
      );
    } else {
      alert("No camera found on this device!");
    }
  }).catch(err => alert("Camera access error: " + err));
}
</script>

</body>
</html>
